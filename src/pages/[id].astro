---
import '@/styles/globals.css';
import Layout from '../layouts/Layout.astro';
import { Button } from '@/components/ui/button';
import {
  Card,
  CardContent,
  CardFooter,
  CardHeader,
  CardTitle,
} from '@/components/ui/card';
import { CalendarIcon } from '@radix-ui/react-icons';

import LockedContent from '@/components/LockedContent';
import { Separator } from '@/components/ui/separator';

import '../styles/locked-page.css';
import type { ContentTable } from '@/lib/db';

type Content = Omit<ContentTable, 'id' | 'url'>;

const { id } = Astro.params;

const res = await fetch(`http://localhost:4321/api/content?id=${id}`);

const data: Content | null = res.status === 200 ? await res.json() : null;
---

<Layout>
  <main class="flex flex-col gap-4">
    <div>
      <h1
        class="scroll-m-20 text-4xl font-extrabold tracking-tight lg:text-5xl"
      >
        Konulu Konum
      </h1>
      <p class="leading-7 [&:not(:first-child)]:mt-6">
        Arkadaşınız size bir fotoğraf ve bir not bıraktı. Fakat fotoğrafı
        görebilmeniz için aşağıdaki konuma gitmeniz gerekiyor. Konuma
        yaklaştığınızda butona basıp fotoğrafı görüntüleyebilirsiniz.
      </p>
    </div>

    <Separator />

    <Card className="w-full">
      <CardHeader>
        <CardTitle>{data?.author}</CardTitle>
      </CardHeader>
      <CardContent>
        <p>{data?.description}</p>
      </CardContent>
      <CardFooter className="gap-2">
        <CalendarIcon />
        <p>5 saat önce</p>
      </CardFooter>
    </Card>

    <LockedContent imageUrl={data?.blob_url} client:load />

    <div
      id="map"
      class="w-full h-[450px] rounded"
      data-target-location={data?.loc}
    >
    </div>

    <Button className="w-full text-lg" size="lg">Paylaş</Button>
    <div class="flex justify-center">
      <p class="text-muted-foreground">
        Fotoğrafın kilidi şu ana dek <b>2</b> kez açıldı
      </p>
    </div>
  </main>
  <script src="../scripts/initMap.js"></script>
</Layout>
